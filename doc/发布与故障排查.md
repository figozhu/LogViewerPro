# 发布与故障排查指南

## 1. 版本策略
- 版本号遵循 `主.次.修订`。
- `main` 分支通过 CI（lint + test + dist）后生成 RC，只有通过 QA-0x 套件后才能打包正式版。

## 2. 构建流程
1. `npm install`
2. `npm run lint`
3. `npm test`
4. `npm run dist`
5. 产物位于 `release/`，含 Win/macOS/Linux 安装包。

## 3. 预发布清单
- [ ] 核对模板/日志单测与 Worker 单测全部通过。
- [ ] 手动验证常用模板（API/Worker）索引、查询、过滤、偏好同步。
- [ ] 检查系统日志面板显示异常及缓存操作。
- [ ] 更新 `doc/用户指南.md` 与本文件的已知问题。

## 4. 常见故障
| 场景 | 处理建议 |
| ---- | -------- |
| Electron 启动空白 | 删除 `node_modules/.vite` 后重新 `npm run dev`；或检查 preload 构建错误 |
| Worker 卡死 / 无响应 | 查看系统日志面板；若模板错误导致无限跳过，可取消任务并修正正则 |
| SQLite db 被锁 | 结束后台进程或删除 `index_cache/*.db`, 重新索引 |
| 偏好无法保存 | 删除 `user-preferences.json`；确认用户目录读写权限 |

## 5. 回滚策略
- 当新版本出现阻塞问题时，使用 Git tag 找到上一稳定版本并 `npm run dist` 重新发布。
- 日志与偏好文件均保存在 `app.getPath('userData')`，回滚不会清除用户数据。

## 6. 反馈渠道
- GitHub Issue（模板问题请附示例日志）
- 内部 IM 群（SRE/QA 可直接 @Owner）
