# 用户指南（LogViewer Pro）

## 1. 产品概览

LogViewer Pro 是一个基于 Electron + Vue3 的跨平台日志解析工具，支持：

- **自定义模板**：通过命名捕获组正则表达式解析任意格式的日志。
- **高速索引**：使用 SQLite/FTS5 建立本地缓存，GB 级日志也能秒级查询。
- **动态查询**：全文搜索、列过滤、排序与分页全部由 QueryBuilder 生成安全 SQL。
- **状态监控**：内置系统日志面板与索引进度面板，方便排障。
- **用户偏好**：记忆主题、默认查询条数与窗口大小，重启后保持一致体验。

## 2. 安装与启动

1. 确保 Node.js ≥ 18 与 npm ≥ 9。
2. 克隆仓库并安装依赖：
   ```bash
   git clone https://github.com/figozhu/LogViewerPro.git
   cd LogViewerPro
   npm install
   ```
3. 开发模式运行：
   ```bash
   npm run dev
   ```
4. 生产构建：
   ```bash
   npm run dist
   ```

## 3. 核心使用流程

### 3.1 模板管理

1. 打开「模板管理」面板，点击「新建」。
2. 填写名称、正则表达式，并指定 `timestamp`/`fts` 字段（需使用命名捕获组）。
3. 可在「示例输入」中粘贴若干日志行，点击「运行 Regex 测试」查看匹配结果。
4. 保存后模板会写入 `electron-store`，在左侧列表中可编辑/删除/导出。

**注意：**
- 正则必须至少包含时间字段与全文字段。
- 重复名称会触发校验提示，需自行更名。

### 3.2 索引缓存

1. 通过菜单或拖拽方式选择日志文件，系统会提示选择模板并启动 Worker 索引。
2. 索引过程展示在「索引与缓存」卡片中，可实时查看进度、取消任务、或在命中缓存时秒开。
3. 缓存保存在 `userData/index_cache/<hash>.db`。面板提供「刷新」「打开目录」「清空缓存」操作。

### 3.3 日志查询

1. 索引完成后，「日志记录」面板会自动加载 Schema 并渲染虚拟滚动表格。
2. 顶部支持全文搜索，侧边提供自动推断的低基数字段过滤器。
3. 默认排序按照模板的时间字段，可在偏好中更改默认 limit。
4. 点击任一日志行，右侧详情会展示 JSON/文本内容，并支持复制。

### 3.4 系统日志与偏好

- **系统日志**：底部面板聚合主进程/Worker/Renderer 日志（`app.log`），可设置显示行数并手动刷新。
- **偏好设置**：可调主题（深色/浅色/跟随系统）、默认查询条数以及窗口记忆。设置即时应用并持久化。

## 4. 快捷键与菜单

- `Ctrl/Cmd + O`：打开日志文件。
- `Ctrl/Cmd + Shift + I`：打开开发者工具（在调试模式下）。
- 菜单中还包含「清空缓存」「查看帮助」等入口，可根据操作系统自动布局。

## 5. 常见问题（FAQ）

### Q1：模板正则测试失败怎么办？
- 确认正则中所有捕获组都命名。
- 使用 `gm` 模式时注意转义，例如 `\\[`。
- 若示例输入存在空行，会自动忽略，可单独粘贴需验证的行。

### Q2：索引速度慢或占用过高？
- 初次索引会读取全量日志，如需提速可先过滤不必要的字段。
- 关闭窗口前可点「取消任务」避免长时间占用。
- 在 QA-06 之前建议使用 1~2GB 文件进行自测，超大文件建议在高性能机器上执行。

### Q3：筛选条件无效？
- 过滤器来源于 Schema 的 TEXT 字段，若模板未捕获对应列则无法筛选。
- 手动编辑模板后需重新索引，缓存会自动失效并重建。

### Q4：日志文件命中缓存但内容没更新？
- 程序通过文件 mtime 判断是否重建缓存，如日志来自新路径或外部复制可能仍视为旧缓存，可在「索引与缓存」中选择「清除缓存」后重试。

### Q5：如何导出日志或索引结果？
- 目前版本主要用于快速查询，可通过表格右键复制或导出选中行。
- 若需批量导出，可直接打开 `index_cache/<hash>.db`（SQLite）自行处理。

## 6. 故障排查

| 现象 | 可能原因 | 排查步骤 |
| ---- | -------- | -------- |
| Worker 长时间 0% | 正则无法匹配/文件巨大 | 查看系统日志面板是否有 `unmatched` 提示，必要时缩小日志范围 |
| IPC 握手失败 | 主进程异常或 preload 阻塞 | 重启应用，确保未被安全软件拦截；查看 `app.log` |
| 偏好未生效 | electron-store 读写失败 | 检查用户目录读写权限，删除 `user-preferences.json` 后重启 |

## 7. 进一步支持

- 运行 `npm test` 可执行所有单元测试。
- 通过 `npm run lint` 保持代码风格统一。
- 若需贡献新功能，请在 PR 中附带对应测试及文档更新。
