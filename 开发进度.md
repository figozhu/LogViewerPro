# 开发进度（LogViewer Pro）

> 基于《需求与实现方案.md》v1.2，所有任务均围绕 Electron + Vue 3 技术栈展开；状态更新时请同步备注，确保可在中断后快速恢复。

## 状态约定
- **未开始**：尚未着手。
- **进行中**：正在开发或联调。
- **已完成**：开发、联调、自测全部通过。
- **阻塞**：受依赖或环境限制暂无法推进，需在备注中写明原因。

## 任务列表

### 0. 项目基建与发布
| 编号 | 任务 | 描述 | 优先级 | 状态 | 备注 |
| --- | --- | --- | --- | --- | --- |
| B-01 | 初始化工程骨架 | 使用 Electron + Vite + Vue 3 + TypeScript，划分主进程、渲染进程、Worker 目录并配置热重载 | 高 | 未开始 | |
| B-02 | 开发体验与规范 | 配置 TypeScript 别名、ESLint、Prettier、lint-staged，并建立统一的提交校验流程 | 中 | 未开始 | |
| B-03 | 打包与发布流程 | 基于 electron-builder 配置 Windows/macOS/Linux 单文件打包，满足 NFR-2 的跨平台要求 | 高 | 未开始 | |
| B-04 | CI/CD 管线 | 建立自动化流水线：安装依赖→单测→E2E→多平台打包→产物上传 | 中 | 未开始 | |

### 1. 主进程与 IPC
| 编号 | 任务 | 描述 | 优先级 | 状态 | 备注 |
| --- | --- | --- | --- | --- | --- |
| M-01 | 主进程启动框架 | 创建 BrowserWindow、启用 contextIsolation、注册菜单与快捷键，确保主进程只做协调 | 高 | 未开始 | |
| M-02 | IPC 通道实现 | 按 TDD 2.4 实现 `templates:*`、`dialog:openFile`、`index:*`、`schema:get`、`query:run`、`filters:getOptions` 等 handler | 高 | 未开始 | |
| M-03 | Worker 生命周期管理 | 在主进程中负责 worker_threads 的创建、重启、错误冒泡与消息转发 | 高 | 未开始 | |
| M-04 | 全局错误与日志 | 捕获未处理异常/拒绝、记录日志并通过对话框或通知反馈给用户 | 中 | 未开始 | |

### 2. 模板管理（FR-1）
| 编号 | 任务 | 描述 | 优先级 | 状态 | 备注 |
| --- | --- | --- | --- | --- | --- |
| T-01 | `LogTemplate` 模型与校验 | 定义模板字段、校验命名捕获组、强制选择时间字段与 FTS 字段 | 高 | 未开始 | |
| T-02 | `electron-store` 持久化 | 将模板集合存储在 `config.json`，含版本迁移、去重、导入/导出能力 | 高 | 未开始 | |
| T-03 | 模板管理界面 | 在 Vue 中实现模板列表、创建、编辑、删除、搜索等 CRUD 能力 | 高 | 未开始 | |
| T-04 | 正则测试工具 | 提供示例日志输入区、实时匹配结果与字段预览，满足 FR-1.3 | 中 | 未开始 | |
| T-05 | 模板选取流程 | 在打开日志时展示模板选择器，并持久化“最近使用的模板”映射 | 中 | 未开始 | |

### 3. 文件处理与缓存（FR-2, NFR-3/4/5）
| 编号 | 任务 | 描述 | 优先级 | 状态 | 备注 |
| --- | --- | --- | --- | --- | --- |
| F-01 | 文件选择与拖拽 | 支持菜单、对话框与拖拽打开日志，校验路径、只读权限与文件大小 | 高 | 未开始 | |
| F-02 | 最近文件列表 | 记录最近打开的文件及其模板，提供快速入口与删除能力 | 中 | 未开始 | |
| F-03 | 索引缓存命名 | 依据 `filePath + template.regex` 计算 MD5，生成 `userData/index_cache/<hash>.db` | 高 | 未开始 | |
| F-04 | 缓存校验与跳过 | 根据文件 `mtime` 判断是否复用缓存，满足 FR-2.4/2.5 | 高 | 未开始 | |
| F-05 | 缓存清理功能 | 实现“清除所有索引缓存”按钮，并支持单个缓存失效与错误处理 | 高 | 未开始 | |
| F-06 | 索引进度控制 | 提供可取消的进度条 UI，对接 `index:progress` 与长任务提示 | 中 | 未开始 | |

### 4. 索引引擎/Worker（FR-2）
| 编号 | 任务 | 描述 | 优先级 | 状态 | 备注 |
| --- | --- | --- | --- | --- | --- |
| W-01 | Worker 启动与通信协议 | 定义与主进程的消息格式，处理初始化/退出/错误场景 | 高 | 未开始 | |
| W-02 | 动态 Schema 生成 | 解析命名捕获组，创建 `logs`、`logs_fts`、`meta` 表并映射字段类型 | 高 | 未开始 | |
| W-03 | FTS5 集成 | 为模板指定的全文字段创建 FTS5 虚拟表并建立触发器/同步策略 | 高 | 未开始 | |
| W-04 | 流式解析与批量写入 | 通过 `fs.createReadStream` + `readline` 逐行解析，批量事务写入 `better-sqlite3` | 高 | 未开始 | |
| W-05 | 进度与完成事件 | 定期发送 `index:progress`、在缓存复用或全量索引完成时发送 `index:complete` | 中 | 未开始 | |
| W-06 | 非匹配行策略 | 对无法匹配 Regex 的行做跳过/标记，并可记录日志供用户检查（NFR-5） | 中 | 未开始 | |
| W-07 | 缓存元数据写入 | 在 `meta` 表中记录 `source_mtime`、模板版本、行数等元信息 | 中 | 未开始 | |
| W-08 | 错误与取消处理 | 支持用户取消索引，优雅关闭文件流，并向主进程报告错误详情 | 中 | 未开始 | |

### 5. 查询引擎与数据访问（FR-3）
| 编号 | 任务 | 描述 | 优先级 | 状态 | 备注 |
| --- | --- | --- | --- | --- | --- |
| Q-01 | 查询构建器 | 根据搜索词、结构化过滤、分页、排序动态拼装 SQL，确保索引使用 | 高 | 未开始 | |
| Q-02 | 过滤器选项提供 | 针对低基数字段执行 `SELECT DISTINCT` 并缓存结果，供渲染层使用 | 中 | 未开始 | |
| Q-03 | `schema:get` 实现 | 返回 Prisma `table_info` 结果并抽象为渲染层可用的 `ColumnInfo[]` | 中 | 未开始 | |
| Q-04 | 性能与安全 | 预编译语句、参数化查询、防止 SQL 注入或无界结果集 | 中 | 未开始 | |

### 6. 渲染层 UI（FR-3）
| 编号 | 任务 | 描述 | 优先级 | 状态 | 备注 |
| --- | --- | --- | --- | --- | --- |
| R-01 | Pinia 全局状态 | 设计 templates、logs、filters、progress、recentFiles 等 Store | 高 | 未开始 | |
| R-02 | 主界面布局 | 构建多栏布局（顶部工具栏 + 侧边栏 + 主内容），适配深浅色主题 | 中 | 未开始 | |
| R-03 | 文件导入流程 | 引导用户选择文件→选择模板→触发 `index:start`，并在 UI 中展示所选信息 | 高 | 未开始 | |
| R-04 | 虚拟滚动日志表 | 使用 `vue-virtual-scroller` 渲染百万级日志，支持列自适应与固定表头（FR-3.2/3.3） | 高 | 未开始 | |
| R-05 | 行详情视图 | 行点击后展示所有字段，JSON 字段自动 pretty-print，支持复制（FR-3.5/3.6） | 中 | 未开始 | |
| R-06 | 日志等级高亮 | 把 `level` 字段映射到颜色（ERROR/WARN 等），支持主题定制（FR-3.4） | 中 | 未开始 | |
| R-07 | 过滤面板与搜索栏 | 根据动态列生成过滤器组件，实时触发查询并显示选中条件 | 高 | 未开始 | |
| R-08 | 索引进度与缓存提示 | 展示进度条、缓存命中状态、错误提示及重试入口 | 中 | 未开始 | |
| R-09 | 最近文件与模板区 | 在 UI 中展示最近记录、允许一键重新打开并说明缓存状态（FR-2.6） | 低 | 未开始 | |

### 7. 运维与设置
| 编号 | 任务 | 描述 | 优先级 | 状态 | 备注 |
| --- | --- | --- | --- | --- | --- |
| S-01 | 缓存管理面板 | 集中展示 `index_cache` 占用、提供一键清理、定位缓存目录（NFR-3/4） | 中 | 未开始 | |
| S-02 | 可观察性与日志 | 为主进程、Worker、Renderer 建立统一日志格式，支持导出诊断包 | 低 | 未开始 | |
| S-03 | 用户偏好设置 | 持久化主题、窗口大小、默认模板等轻量偏好项 | 低 | 未开始 | |

### 8. 测试与质量保障
| 编号 | 任务 | 描述 | 优先级 | 状态 | 备注 |
| --- | --- | --- | --- | --- | --- |
| QA-01 | 单元测试（模板/校验） | 覆盖命名捕获解析、字段校验、配置持久化等关键逻辑 | 中 | 未开始 | |
| QA-02 | Worker 集成测试 | 使用示例日志验证索引、缓存命中/失效、非匹配行策略 | 高 | 未开始 | |
| QA-03 | 查询引擎测试 | 针对全文搜索、组合过滤、分页做回归测试 | 中 | 未开始 | |
| QA-04 | 渲染层组件测试 | 对 Pinia Store、虚拟列表、过滤面板做组件级测试 | 低 | 未开始 | |
| QA-05 | 端到端测试 | 通过 Playwright/ Spectron 等脚本覆盖“打开→索引→搜索→查看详情”流程 | 高 | 未开始 | |
| QA-06 | 性能与内存基准 | 构造 >5GB 日志模拟索引与滚动，验证 CPU/内存占用满足大文件要求 | 高 | 未开始 | |
| QA-07 | 打包冒烟测试 | 在 Windows/macOS/Linux 上验证安装包启动、读取文件、缓存写入 | 中 | 未开始 | |

### 9. 文档与支持
| 编号 | 任务 | 描述 | 优先级 | 状态 | 备注 |
| --- | --- | --- | --- | --- | --- |
| D-01 | 用户指南 | 编写模板创建、正则命名规则、索引缓存管理等使用说明 | 中 | 未开始 | |
| D-02 | 开发者文档 | 补充架构概览、IPC 协议、模块接口，方便后续维护 | 中 | 未开始 | |
| D-03 | 发布与疑难排查 | 制定版本发布清单、常见问题及日志收集办法 | 低 | 未开始 | |
